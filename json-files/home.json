document.addEventListener('DOMContentLoaded', () => {
  const navLinks = document.querySelectorAll('.main-nav-menu .landing-mnu');
  const dynamicContentArea = document.getElementById('dynamic-content-area');

  /**
   * Recursively creates DOM elements from JSON definitions
   * @param {Object} node - A JSON object representing an HTML element
   * @returns {HTMLElement | Text}
   */
  function createElementFromJson(node) {
    // Text node
    if (typeof node === 'string') {
      return document.createTextNode(node);
    }

    // Create element
    const el = document.createElement(node.type);

    // Apply attributes (class, id, src, etc.)
    for (const key in node) {
      if (['type', 'children', 'content'].includes(key)) continue;
      el.setAttribute(key, node[key]);
    }

    // Add text content if present
    if (node.content) {
      el.textContent = node.content;
    }

    // Recursively add children
    if (node.children && Array.isArray(node.children)) {
      node.children.forEach((child) => {
        el.appendChild(createElementFromJson(child));
      });
    }

    return el;
  }

  /**
   * Render page JSON into the dynamic content area
   */
  async function loadJsonContent(pageName) {
    const jsonFileName = `${pageName}.json`;

    try {
      const response = await fetch(`/json-files/${jsonFileName}`);
      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

      const data = await response.json();

      // Clear current content
      dynamicContentArea.innerHTML = '';

      // Expecting data.pageContent (array)
      if (data.pageContent && Array.isArray(data.pageContent)) {
        data.pageContent.forEach((block) => {
          dynamicContentArea.appendChild(createElementFromJson(block));
        });
      } else {
        dynamicContentArea.innerHTML = '<p>Invalid JSON format: missing pageContent array.</p>';
      }

      // Update active nav link
      navLinks.forEach((link) => link.classList.remove('is-active'));
      const activeLink = document.querySelector(`.main-nav-menu a[data-page="${pageName}"]`);
      if (activeLink) activeLink.classList.add('is-active');

    } catch (error) {
      console.error(`Error loading JSON for ${pageName}:`, error);
      dynamicContentArea.innerHTML = `<p>Error loading content for "${pageName}".</p>`;
    }
  }

  // Navigation link clicks
  navLinks.forEach((link) => {
    link.addEventListener('click', (event) => {
      event.preventDefault();
      const pageName = event.currentTarget.dataset.page;
      if (pageName) loadJsonContent(pageName);
    });
  });

  // Initial page load
  const initialPage = window.location.pathname.substring(1) || 'home';
  loadJsonContent(initialPage);
});
